# PW-021 Комментарии на странице статьи (one-column-article)

## Суть

Добавить блок комментариев под статьёй. Комментарии — в два уровня: корневые и ответы на них. Поведение блока зависит от
того, залогинен пользователь или нет.

## Два режима

**Авторизованный пользователь**

- Видит форму «Написать комментарий» и может оставлять корневые комментарии
- Может отвечать на любой комментарий (кнопка «Ответить») — ответ показывается под родительским с отступом
- Может редактировать/удалять свои комментарии (если решим включать в первый релиз — отдельно оговорить)

**Неавторизованный пользователь**

- Видит все комментарии (корневые и ответы), но форму не видит
- Вместо формы — текст вроде «Войдите, чтобы оставить комментарий» со ссылкой на вход
- Кнопки «Ответить» либо скрыты, либо ведут на страницу входа (решить при реализации)

## Структура комментария

- Аватар, имя, дата/время (относительное: «2 часа назад»)
- Текст комментария
- Кнопка «Ответить» (для залогиненных)
- Ответы — с отступом слева, визуально вложены под родителем (один уровень вложенности, без «ответ на ответ»)

### Сворачивание второго уровня

Типовая практика: если у корневого комментария много ответов, не показывать все сразу.

- По умолчанию показывать первые N ответов (например 3). Остальные скрыты.
- Под видимыми ответами — кнопка/ссылка: «Показать ещё K ответов» (K = оставшееся количество). По клику — раскрыть все
  ответы под этим корнем.
- После раскрытия — кнопка «Свернуть ответы»: снова оставить видимыми только первые N.
- Порог N задаётся константой (например 3), чтобы и одна длинная ветка не раздувала страницу.

## Где размещать

Блок комментариев — внизу one-column-article, после контента статьи (после блока автора, ресурсов и т.д.), в той же
колонке, с тем же выравниванием по ширине, что и текст статьи.

## Мок-данные

Структура: корневые комментарии + у каждого опционально массив ответов (`replies`). Для типа можно расширить
существующий `Comment` (см. packages/types/comment.ts) полем `parentId?: string` и отдавать с бэка уже сгруппированные
по корням, либо ввести тип «комментарий статьи» с полем `replies: Comment[]`.

Пример мока для одной статьи (2–3 корневых, у одного — 5+ ответов, чтобы проверять сворачивание):

| Корневой                                                                                   | Ответы                                                                                                                                                                                             |
| ------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Алексей: «Статья полезная, но хотелось бы больше примеров по разделу X.»                   | —                                                                                                                                                                                                  |
| Мария: «Согласна с предыдущим оратором. Ещё вопрос: поддерживается ли Y в текущей версии?» | Ольга: «Да, с версии 2.1.»; Дмитрий: «Документация здесь: …»; Мария: «Спасибо!»; Николай: «Добавлю в статью ссылку.»; Ольга: «Отлично, буду ждать.» (итого 5 ответов — порог для «Показать ещё N») |
| Игорь: «Спасибо за материал.»                                                              | —                                                                                                                                                                                                  |

Имена, даты и короткие тексты — произвольные, но реалистичные. Хранить в конфиге или в `lib/mock-api` рядом с другими
моками статьи.

## Технические заметки

- Типы комментариев уже есть или будут расширены (см. PW-017); для дерева — `parentId` или вложенный `replies`
- Данные пока мокать; API и сохранение — отдельная история
- Стили: в духе существующих карточек (как в PW-017), без тяжёлого дизайна

## Чеклист (при реализации)

- [ ] Блок «Комментарии» в ArticlePageOneColumn
- [ ] Отображение списка: корневые + ответы с отступом
- [ ] Сворачивание ответов: по умолчанию первые N, «Показать ещё K» / «Свернуть ответы»
- [ ] Мок-данные: 2–3 корневых, у одного 5+ ответов (проверка сворачивания)
- [ ] Режим «гость»: только чтение + призыв войти вместо формы
- [ ] Режим «авторизован»: форма нового комментария + кнопка «Ответить»
- [ ] Внешний вид: аватар, имя, время, текст, кнопка ответа
- [ ] Адаптив и доступность (фокус, aria, клавиатура)

## Связанные задачи

- PW-009 — страница one-column-article (куда встраиваем)
- PW-017 — страница «Мои комментарии» (типы и стили карточки комментария)
- PW-008 — вход (ссылка «Войдите» для гостя)

## История

- 2026-01-29: Постановка задачи
