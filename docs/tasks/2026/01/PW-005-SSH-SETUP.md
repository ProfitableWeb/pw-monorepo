# –®–ø–∞—Ä–≥–∞–ª–∫–∞: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Cloud.ru

## üìç –ì–¥–µ –Ω–∞–π—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ Cloud.ru

1. **IP –∞–¥—Ä–µ—Å VM:**
   - –ö–æ–Ω—Å–æ–ª—å Cloud.ru ‚Üí –í—ã–±—Ä–∞—Ç—å VM ‚Üí –†–∞–∑–¥–µ–ª "–°–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã"
   - –ò–ª–∏: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" ‚Üí "–°–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã" ‚Üí "–ü—É–±–ª–∏—á–Ω—ã–π IP"

2. **–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - –î–ª—è Ubuntu 22.04: **`ubuntu`** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –†–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"
   - –ò–ª–∏ —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∫–æ–Ω—Å–æ–ª—å Cloud.ru

3. **–ü–∞—Ä–æ–ª—å (–¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è):**
   - –†–∞–∑–¥–µ–ª "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏" ‚Üí "–ü–∞—Ä–æ–ª—å"
   - –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∫–æ–Ω—Å–æ–ª—å

## üîë –î–æ–±–∞–≤–ª–µ–Ω–∏–µ SSH –∫–ª—é—á–∞ –Ω–∞ VM

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –∫–æ–Ω—Å–æ–ª—å Cloud.ru (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –í –∫–æ–Ω—Å–æ–ª–∏ Cloud.ru: **"–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å"** ‚Üí –æ—Ç–∫—Ä—ã—Ç—å
2. –í–æ–π—Ç–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å)
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã:

```bash
# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è SSH –∫–ª—é—á–µ–π
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# –î–æ–±–∞–≤–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ ~/.ssh/cloudru_deploy.pub)
nano ~/.ssh/authorized_keys
# –í—Å—Ç–∞–≤–∏—Ç—å –∫–ª—é—á, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å (Ctrl+O, Enter, Ctrl+X)

# –ò–ª–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π (–∑–∞–º–µ–Ω–∏—Ç—å YOUR_PUBLIC_KEY):
echo "YOUR_PUBLIC_KEY" >> ~/.ssh/authorized_keys

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
chmod 600 ~/.ssh/authorized_keys
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ SSH —Å –ø–∞—Ä–æ–ª–µ–º

```bash
# –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –∏–∑–≤–µ—Å—Ç–µ–Ω, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ssh-copy-id
ssh-copy-id -i ~/.ssh/cloudru_deploy.pub ubuntu@IP_–ê–î–†–ï–°_VM

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
cat ~/.ssh/cloudru_deploy.pub | ssh ubuntu@IP_–ê–î–†–ï–°_VM "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
ssh -i ~/.ssh/cloudru_deploy ubuntu@IP_–ê–î–†–ï–°_VM
# –î–æ–ª–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
```

## üîê –î–æ–±–∞–≤–ª–µ–Ω–∏–µ secrets –≤ CI/CD

### GitVerse / GitLab CI

1. –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: **Settings ‚Üí CI/CD ‚Üí Variables**
2. –ù–∞–∂–∞—Ç—å **"Add variable"**
3. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

| Key               | Value                                          | Protected | Masked |
| ----------------- | ---------------------------------------------- | --------- | ------ |
| `SSH_PRIVATE_KEY` | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `~/.ssh/cloudru_deploy` (–≤–µ—Å—å —Ñ–∞–π–ª) | ‚úÖ        | ‚úÖ     |
| `SSH_HOST`        | IP –∞–¥—Ä–µ—Å VM (–Ω–∞–ø—Ä–∏–º–µ—Ä: `185.123.45.67`)        | ‚úÖ        | ‚ùå     |
| `SSH_USER`        | `ubuntu`                                       | ‚úÖ        | ‚ùå     |
| `SSH_PORT`        | `22`                                           | ‚úÖ        | ‚ùå     |

**–í–∞–∂–Ω–æ:**

- `SSH_PRIVATE_KEY` –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å —Å—Ç—Ä–æ–∫–∏ `-----BEGIN OPENSSH PRIVATE KEY-----` –∏ `-----END OPENSSH PRIVATE KEY-----`
- –í–∫–ª—é—á–∏—Ç—å "Masked" –¥–ª—è `SSH_PRIVATE_KEY` (—Å–∫—Ä—ã–≤–∞–µ—Ç –≤ –ª–æ–≥–∞—Ö)
- –í–∫–ª—é—á–∏—Ç—å "Protected" –¥–ª—è –≤—Å–µ—Ö (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ protected –≤–µ—Ç–∫–∞—Ö)

### GitHub Actions

1. –í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: **Settings ‚Üí Secrets and variables ‚Üí Actions**
2. –ù–∞–∂–∞—Ç—å **"New repository secret"**
3. –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã:

| Name              | Secret                             |
| ----------------- | ---------------------------------- |
| `SSH_PRIVATE_KEY` | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `~/.ssh/cloudru_deploy` |
| `SSH_HOST`        | IP –∞–¥—Ä–µ—Å VM                        |
| `SSH_USER`        | `ubuntu`                           |
| `SSH_PORT`        | `22`                               |

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. **–õ–æ–∫–∞–ª—å–Ω–æ:** `ssh -i ~/.ssh/cloudru_deploy ubuntu@IP` —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–∞—Ä–æ–ª—è
2. **CI/CD:** –ó–∞–ø—É—Å—Ç–∏—Ç—å pipeline –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —Å–¥–µ–ª–∞—Ç—å push –≤ `main`
3. **–õ–æ–≥–∏:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**"Permission denied (publickey)"**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ `~/.ssh/authorized_keys` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 600)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ `~/.ssh` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 700)
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**"Host key verification failed"**

- –í CI/CD –¥–æ–±–∞–≤–∏—Ç—å `ssh-keyscan` (—É–∂–µ –µ—Å—Ç—å –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö)

**"Connection refused"**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ VM –∑–∞–ø—É—â–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall –≤ Cloud.ru (–ø–æ—Ä—Ç 22 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å IP –∞–¥—Ä–µ—Å–∞
